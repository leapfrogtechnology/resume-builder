---
dist: bionic
language: generic
branches:
  only:
    - dev
    - master
    - travis-integration
  
git:
  depth: false

# Setting stage
env:
  - STAGE=$(if [ $TRAVIS_BRANCH == 'travis-integration' ]; then echo "dev"; elif [ $TRAVIS_BRANCH == 'master' ]; then echo 'production'; else echo "Undefined"; fi;)

matrix:
  include:
    - name: API
      node_js:
        - 12
      install:
        - curl -sf https://up.apex.sh/install | sudo sh
        - curl -sf https://raw.githubusercontent.com/pratishshr/envault/master/install.sh | sudo sh
      deploy:
        provider: script
        script:
          cd api;
          envault list -secret=resume-builder/$STAGE/api > .env;
          yarn && yarn build;
          up $STAGE;
        on:
          all_branches: true